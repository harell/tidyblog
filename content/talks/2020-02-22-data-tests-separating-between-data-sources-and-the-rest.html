---
title: 'Data Tests: Separating between Data Sources and the Rest'
author: Harel Lustiger
date: '2020-02-22'
slug: data-tests-separating-between-data-sources-and-the-rest
draft: true
categories:
  - R
  - Software Architecture
tags:
  - plugin architecture
  - data sources
  - small design up front
bibliography: [references-talks.bib]
biblio-style: apalike
link-citations: yes  
---

<script src="/rmarkdown-libs/kePrint/kePrint.js"></script>

<div id="TOC">
<ul>
<li><a href="#abstract">Abstract</a></li>
<li><a href="#setup">Setup</a><ul>
<li><a href="#meet-euel-cheatam-the-merceduce-dealership-manager">Meet Euel Cheatam the Merceduce dealership manager</a></li>
<li><a href="#the-proposed-solution-is-a-weekly-fact-sheet-with-popular-qa">The proposed solution is a weekly fact sheet with popular Q&amp;A</a></li>
<li><a href="#the-developers-encounter-real-world-impediments">The developers encounter real-world impediments</a></li>
</ul></li>
<li><a href="#st-iteration-developing-a-data-driven-app-without-real-data">1<sup>st</sup> iteration: developing a data-driven app without real data</a><ul>
<li><a href="#generate-dataset-assumption-triplet">Generate dataset assumption triplet</a></li>
<li><a href="#convert-assumptions-to-assertions-with-data-tests">Convert assumptions to assertions with data-tests</a></li>
<li><a href="#implement-data-source-plugins">Implement data source plugins</a></li>
<li><a href="#implement-analytic-applications">Implement analytic applications</a></li>
</ul></li>
<li><a href="#nd-iteration-implementing-customer-feedback">2<sup>nd</sup> iteration: implementing customer feedback</a></li>
<li><a href="#rd-iteration-deploying-the-application-with-real-data">3<sup>rd</sup> iteration: deploying the application with real data</a></li>
</ul>
</div>

<div id="abstract" class="section level2">
<h2>Abstract</h2>
<p>Data science projects in commercial companies often experience a challenge
arising from evolving data sources. As the project progresses, new signals and
information sources are added incrementally. In practice, when the data source
changes, it creates a need to change the application source code.</p>
<p>With <strong>no design up front</strong>, some application modules, such as a dashboard or a
machine learning model, unwittingly become dependent on the data source. In this
case, accommodating the evolving data source is not simply a matter of changing
the code related to the data source. Rather, preserving the rest of the existing
application in a working condition involves further code changes in distant
elements of the application.</p>
<p>An alternative way of dealing with evolving data sources is to introduce a
<strong>small design up front</strong>. Such design lets programmers manage the source code
dependencies throughout the project life-cycle.</p>
<p>This post suggests a design that <mark>(1) separates data sources from analytic
applications and (2) restricts analytic applications from knowing about the data
sources</mark>.</p>
<p>While the evolving data sources challenge is programming language agnostic, this
post demonstrates an implementation of the suggested design in R.</p>
</div>
<div id="setup" class="section level2">
<h2>Setup</h2>
<div id="meet-euel-cheatam-the-merceduce-dealership-manager" class="section level3">
<h3>Meet Euel Cheatam the Merceduce dealership manager</h3>
<p><img src="https://i.imgflip.com/2qlpbb.jpg" width="100%" style="display: block; margin: auto;" /></p>
<p>Eual has been working in Mercedes dealership as a car salesman for the last 7
years. Today, Eual serves as the dealership manager. His main duty is to ensure
a profitable, complaint, and effective dealership.</p>
<ul>
<li>Eual <strong>thinks</strong> that a professional car salesperson needs to answer prospects
queries quickly and accurately.</li>
<li>Eual <strong>sees</strong> that it takes new hires several months to master the
dealership’s car specifications. During these months new-hires convert fewer
prospects into clients; this causes new hires to get demotivated; which leads to
fewer sales – it’s a vicious cycle.</li>
<li>Eual <strong>feels</strong> obligated to provide resources that will enable everyone to
succeed as a salesperson, regardless of their work tenure.</li>
<li>Eual <strong>does</strong> not have enough free time slots in his calendar to accommodate
daily mentoring for all the dealership salespeople.</li>
</ul>
</div>
<div id="the-proposed-solution-is-a-weekly-fact-sheet-with-popular-qa" class="section level3">
<h3>The proposed solution is a weekly fact sheet with popular Q&amp;A</h3>
<p><img src="https://i.imgur.com/CMbZ8h7.png" width="100%" style="display: block; margin: auto;" /></p>
<!-- Position Statement -->
<p>For the car salespeople who work at Mercedes dealership, the <em>Factcedes™</em> is a
weekly email service that provides a succinct and readable fact sheet with
popular Q&amp;A about the dealership vehicles. Unlike water cooler talks, our
product has been carefully formulated and evaluated against veterans and is
distributed regularly.</p>
</div>
<div id="the-developers-encounter-real-world-impediments" class="section level3">
<h3>The developers encounter real-world impediments</h3>
<p><img src="https://i.imgur.com/TAcOHZO.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="st-iteration-developing-a-data-driven-app-without-real-data" class="section level2">
<h2>1<sup>st</sup> iteration: developing a data-driven app without real data</h2>
<p>The report includes a tidy data table, where each variable is a column and
each observation is a row.</p>
<div id="generate-dataset-assumption-triplet" class="section level3">
<h3>Generate dataset assumption triplet</h3>
<p>Start by making <strong>assumption triplets</strong> about what information the user needs to
see:</p>
<ul>
<li><strong>Primary Key</strong> represents car models; and</li>
<li><strong>Target variable</strong> is the price; and</li>
<li><strong>Salient features</strong> include gear, and mpg.</li>
</ul>
</div>
<div id="convert-assumptions-to-assertions-with-data-tests" class="section level3">
<h3>Convert assumptions to assertions with data-tests</h3>
<ul>
<li>Data-tests are assertions that ensure <a href="https://en.wikipedia.org/wiki/Data_integrity">data
integrity</a>, mainly, they concern
the data existance and structure.</li>
<li>Data tests are like clauses in a contract.</li>
<li>The analytic application dictates the clauses.</li>
<li>The analytic application is dependent only on the clauses.</li>
</ul>
<pre class="r"><code># data-tests.R
## 1. Check if the dataset exists
stopifnot(exist(&quot;cars_data&quot;), is.data.frame(cars_data))
  
## 2. Check if the necessary columns exist
expected_cols &lt;- c(&quot;car_model&quot;, &quot;price&quot;, &quot;gear&quot;, &quot;mpg&quot;)
stopifnot(all(expected_cols %in% colnames(cars_data)))
  
## 3. Check if the records are unique
is.distinct &lt;- function(x) dplyr::n_distinct(x) == length(x)
stopifnot(is.distinct(mtcars$car_model))</code></pre>
</div>
<div id="implement-data-source-plugins" class="section level3">
<h3>Implement data source plugins</h3>
<div id="quick-glimpse-over-the-mtcars-dataset" class="section level4">
<h4>Quick glimpse over the <code>mtcars</code> dataset</h4>
<table class="table table-striped" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-2">Table 1: </span>The first 6 car models from <code>datasets::mtcars</code>
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
mpg
</th>
<th style="text-align:right;">
cyl
</th>
<th style="text-align:right;">
disp
</th>
<th style="text-align:right;">
hp
</th>
<th style="text-align:right;">
drat
</th>
<th style="text-align:right;">
wt
</th>
<th style="text-align:right;">
qsec
</th>
<th style="text-align:right;">
vs
</th>
<th style="text-align:right;">
am
</th>
<th style="text-align:right;">
gear
</th>
<th style="text-align:right;">
carb
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Mazda RX4
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
160
</td>
<td style="text-align:right;">
110
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
Mazda RX4 Wag
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
160
</td>
<td style="text-align:right;">
110
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
Datsun 710
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
108
</td>
<td style="text-align:right;">
93
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Hornet 4 Drive
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
258
</td>
<td style="text-align:right;">
110
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Hornet Sportabout
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
360
</td>
<td style="text-align:right;">
175
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
Valiant
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
225
</td>
<td style="text-align:right;">
105
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
</div>
<div id="generate-synthetic-datasynthetic-data-plugin" class="section level4">
<h4>Generate synthetic data<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> plugin</h4>
<pre class="r"><code># data-source.R
## 1. Generate records 
data(mtcars, package = &quot;datasets&quot;)
cars_data &lt;- mtcars %&gt;% tibble::rownames_to_column(&quot;car_model&quot;)
  
## 2. Generate price
set.seed(2020)
price &lt;- runif(n = nrow(cars_data), min = 41, max = 75)
cars_data &lt;- cars_data %&gt;% tibble::add_column(price = price)
  
## Run data-tests
source(&quot;data-tests.R&quot;)</code></pre>
</div>
</div>
<div id="implement-analytic-applications" class="section level3">
<h3>Implement analytic applications</h3>
<pre class="r"><code># booklet.R
## 1. Get the data
source(&quot;data-tests.R&quot;)
  
## 2. Render booklet
knitr::kable(cars_data)
boxplot(price ~ gear, cars_data)  </code></pre>
</div>
</div>
<div id="nd-iteration-implementing-customer-feedback" class="section level2">
<h2>2<sup>nd</sup> iteration: implementing customer feedback</h2>
</div>
<div id="rd-iteration-deploying-the-application-with-real-data" class="section level2">
<h2>3<sup>rd</sup> iteration: deploying the application with real data</h2>
<!-- ## 3^rd^ iteration: plug in the real data source to the application -->
<!-- Footnotes -->
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>A synthetic datasetis contains data that is artificially
created rather than being generated by actual events.<a href="#fnref1" class="footnote-back">↩</a></p></li>
</ol>
</div>
