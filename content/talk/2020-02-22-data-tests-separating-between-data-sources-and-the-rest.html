---
title: 'Data Tests: Separating between Data Sources and the Rest'
author: Harel Lustiger
date: '2020-02-22'
slug: data-tests-separating-between-data-sources-and-the-rest
draft: true
categories:
  - R
  - Software Architecture
tags:
  - plugin architecture
  - data sources
  - small design up front
---

<script src="/rmarkdown-libs/kePrint/kePrint.js"></script>

<div id="TOC">
<ul>
<li><a href="#abstract">Abstract</a></li>
<li><a href="#setup">Setup</a><ul>
<li><a href="#meet-euel-cheatam-the-car-salesman-at-merceduce-dealership">Meet Euel Cheatam the car salesman at Merceduce dealership</a></li>
</ul></li>
<li><a href="#developing-a-data-driven-app-without-available-data">Developing a data-driven app without available data</a><ul>
<li><a href="#generate-dataset-assumption-triplet">Generate dataset assumption triplet</a></li>
<li><a href="#convert-assumptions-to-assertions-with-data-tests">Convert assumptions to assertions with data-tests</a></li>
<li><a href="#implement-data-source-plugins">Implement data source plugins</a></li>
</ul></li>
<li><a href="#a-system-with-no-design-up-front">A system with no design up front</a></li>
<li><a href="#references">References</a></li>
</ul>
</div>

<div id="abstract" class="section level2">
<h2>Abstract</h2>
<p>Data science projects in commercial companies often experience a challenge
arising from evolving data sources. As the project progresses, new signals and
information sources are added incrementally. In practice, when the data source
changes, it creates a need to change the application source code.</p>
<p>With <strong>no design up front</strong>, some application modules, such as a dashboard or a
machine learning model, unwittingly become dependent on the data source. In this
case, accommodating the evolving data source is not simply a matter of changing
the code related to the data source. Rather, preserving the rest of the existing
application in a working condition involves further code changes in distant
elements of the application.</p>
<p>An alternative way of dealing with evolving data sources is to introduce a
<strong>small design up front</strong>. Such design lets programmers manage the source code
dependencies throughout the project life-cycle.</p>
<p>This post suggests a design that <mark>(1) separates data sources from analytic
applications and (2) restricts analytic applications from knowing about the data
sources</mark>.</p>
<p>While the evolving data sources challenge is programming language agnostic, this
post demonstrates an implementation of the suggested design in R.</p>
</div>
<div id="setup" class="section level2">
<h2>Setup</h2>
<div id="meet-euel-cheatam-the-car-salesman-at-merceduce-dealership" class="section level3">
<h3>Meet Euel Cheatam the car salesman at Merceduce dealership</h3>
<p><img src="https://i.imgflip.com/2qlpbb.jpg" width="100%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="developing-a-data-driven-app-without-available-data" class="section level2">
<h2>Developing a data-driven app without available data</h2>
<p>The report includes a tidy data table, where each variable is a column and
each observation is a row.</p>
<div id="generate-dataset-assumption-triplet" class="section level3">
<h3>Generate dataset assumption triplet</h3>
<p>Start by making <strong>assumption triplets</strong> about what information the user needs to
see:</p>
<ul>
<li><strong>Records</strong><a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a> are car models; and</li>
<li><strong>Target variable</strong> is the price; and</li>
<li><strong>Salient features</strong> include gear, and mpg.</li>
</ul>
</div>
<div id="convert-assumptions-to-assertions-with-data-tests" class="section level3">
<h3>Convert assumptions to assertions with data-tests</h3>
<pre class="r"><code># data-tests.R
## 1. Check if the dataset exists
stopifnot(exist(&quot;cars_data&quot;), is.data.frame(cars_data))
  
## 2. Check if the necessary columns exist
expected_cols &lt;- c(&quot;car_model&quot;, &quot;price&quot;, &quot;gear&quot;, &quot;mpg&quot;)
stopifnot(all(expected_cols %in% colnames(cars_data)))
  
## 3. Check if the records are unique
is.distinct &lt;- function(x) dplyr::n_distinct(x) == length(x)
stopifnot(is.distinct(mtcars$car_model))</code></pre>
</div>
<div id="implement-data-source-plugins" class="section level3">
<h3>Implement data source plugins</h3>
<div id="quick-glimpse-over-the-mtcars-dataset" class="section level4">
<h4>Quick glimpse over the <code>mtcars</code> dataset</h4>
<table class="table table-striped" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-2">Table 1: </span>The first 6 car models from <code>datasets::mtcars</code>
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:right;">
mpg
</th>
<th style="text-align:right;">
cyl
</th>
<th style="text-align:right;">
disp
</th>
<th style="text-align:right;">
hp
</th>
<th style="text-align:right;">
drat
</th>
<th style="text-align:right;">
wt
</th>
<th style="text-align:right;">
qsec
</th>
<th style="text-align:right;">
vs
</th>
<th style="text-align:right;">
am
</th>
<th style="text-align:right;">
gear
</th>
<th style="text-align:right;">
carb
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Mazda RX4
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
160
</td>
<td style="text-align:right;">
110
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
16
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
Mazda RX4 Wag
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
160
</td>
<td style="text-align:right;">
110
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
4
</td>
</tr>
<tr>
<td style="text-align:left;">
Datsun 710
</td>
<td style="text-align:right;">
23
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
108
</td>
<td style="text-align:right;">
93
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
2
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
4
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Hornet 4 Drive
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
258
</td>
<td style="text-align:right;">
110
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
Hornet Sportabout
</td>
<td style="text-align:right;">
19
</td>
<td style="text-align:right;">
8
</td>
<td style="text-align:right;">
360
</td>
<td style="text-align:right;">
175
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
Valiant
</td>
<td style="text-align:right;">
18
</td>
<td style="text-align:right;">
6
</td>
<td style="text-align:right;">
225
</td>
<td style="text-align:right;">
105
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
20
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
3
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
</div>
<div id="generate-synthetic-datasynthetic-data-plugin" class="section level4">
<h4>Generate synthetic data<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a> plugin</h4>
<pre class="r"><code># synthetic-data.R
## 1. Generate records 
data(mtcars, package = &quot;datasets&quot;)
cars_data &lt;- mtcars %&gt;% tibble::rownames_to_column(&quot;car_model&quot;)
  
## 2. Generate price
set.seed(2020)
price &lt;- runif(n = nrow(cars_data), min = 41, max = 75)
cars_data &lt;- cars_data %&gt;% tibble::add_column(price = price)
  
## Run data-tests
source(&quot;data-tests.R&quot;)</code></pre>
<hr />
</div>
</div>
</div>
<div id="a-system-with-no-design-up-front" class="section level2">
<h2>A system with no design up front</h2>
<p>Direct connection between the data source and the analytic application</p>
<pre class="r"><code># main.R
  
## Data Source: Local File
data(mtcars, package = &quot;datasets&quot;)
cars &lt;- 
  mtcars %&gt;% 
  tibble::rownames_to_column(&quot;car_model&quot;) 
  
## Analytic Application: Booklet (report)
render_booklet &lt;- function(data){
 boxplot(mpg ~ cyl, data) 
 data %&gt;% dplyr::select(car_model, mpg, gear) %&gt;%  knitr::kable()
}
render_cars_report(mtcars)</code></pre>
</div>
<div id="references" class="section level2">
<h2>References</h2>
</div>
<div class="footnotes">
<hr />
<ol>
<li id="fn1"><p>A record is what constitutes a row in a tidy data table.<a href="#fnref1" class="footnote-back">↩</a></p></li>
<li id="fn2"><p>A synthetic datasetis contains data that is artificially
created rather than being generated by actual events.<a href="#fnref2" class="footnote-back">↩</a></p></li>
</ol>
</div>
